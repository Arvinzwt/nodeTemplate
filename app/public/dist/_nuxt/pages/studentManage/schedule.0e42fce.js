(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{484:function(e,t,n){var content=n(505);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(37).default)("5c93a949",content,!0,{sourceMap:!1})},504:function(e,t,n){"use strict";var r=n(484);n.n(r).a},505:function(e,t,n){(t=n(36)(!1)).push([e.i,".el-radio[data-v-3eb4ede2]{margin-right:10px}.footer[data-v-3eb4ede2]{margin-top:80px;text-align:center}.contract[data-v-3eb4ede2]{width:100%;margin-bottom:30px}[data-v-3eb4ede2] .el-dialog__header{border-bottom:1px solid #e5e5e5}.select_explain[data-v-3eb4ede2]{margin-top:10px;height:20px}.select_explain .explain_color[data-v-3eb4ede2]{float:left;width:8px;height:8px;border-radius:4px;margin-top:6px}.select_explain .explain_content[data-v-3eb4ede2]{float:left;height:20px;line-height:20px;margin-left:5px;margin-right:15px;color:#666}.select_explain .pink[data-v-3eb4ede2]{background:#ffd1c1}",""]),e.exports=t},534:function(e,t,n){"use strict";n.r(t);var r=n(497),l=n(478),o={name:"schedule",components:{CalendarTable:r.a,SelectTeacher:l.a},data:function(){return{paramMap:{subject:"",teachType:""},contractList:[],originContractList:[],selectTimeList:[{date:"2020-1-1",timePeriod:"08:10~10:00",teachType:"直播",id:1}],allTimeList:[],dialogVisible:!1,searchTeacherData:{isExceptOldTeacher:!1,studentId:null,htType:"",htId:"",htDetailId:"",kecheng:"",grade:"1",bookTime:[],adminId:"",city:"",org_code:""},data:[{label:1,name:"张三",sex:1}],teacherData:{title:"排课ma",subject:""},rules:{subject:{required:!0,message:"请选择学科",trigger:"change"},teachType:{required:!0,message:"请选择授课形式",trigger:"change"}}}},mounted:function(){this.getAllData()},computed:{options:function(){return this.$store.state.dicInfo}},methods:{showDialog:function(){this.$refs.selectTeacher.showDialog()},changeTeachType:function(){this.getHetongDetailList(),this.$refs.form.validate((function(e){if(!e)return!1;console.log(1)}))},changeSubject:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;e.contractList=[],e.originContractList.forEach((function(t){t.kecheng===e.paramMap.subject&&e.contractList.push(t)}))}))},getHetongDetailList:function(){var e=this,data={schoolId:1,studentName:"",courseStyle:this.paramMap.teachType};this.$api.student.getHetongDetailList(data).then((function(t){e.originContractList=t,e.contractList=[],t.forEach((function(t){t.kecheng===e.paramMap.subject&&e.contractList.length<3&&e.contractList.push(Object.assign(t,{label:""}))}))}))},optionChange:function(e,t,n){var r=this;if("INPUT"!==e.target.tagName){var l=JSON.parse(JSON.stringify(this.contractList));l[n].label=1,this.contractList=[],l.forEach((function(e,t){n===t?r.contractList.push(Object.assign(e,{label:1})):r.contractList.push(Object.assign(e,{label:0}))}))}},changeCourse:function(e,t,data){console.log(data);var circle=this.$refs.calendarTable.calendarTable.showPeriod,n=this.contractList.some((function(e){return 1===e.label}));return this.paramMap.teachType||0==this.paramMap.teachType?n?void(this.$refs.calendarTable.courseData[e].data[t].teachType&&this.$refs.calendarTable.courseData[e].data[t].teachType===+this.paramMap.teachType?(this.$refs.calendarTable.changeBackground(e,t,0),this.changeIsShow(data.date,data.timePeriod,+this.paramMap.teachType,circle,!1)):(this.changeIsShow(data.date,data.timePeriod,+this.paramMap.teachType,circle,!0),this.$refs.calendarTable.changeBackground(e,t,+this.paramMap.teachType))):(this.$message.error("请先选择一个合同"),!1):(this.$message.error("请先选择授课形式"),!1)},deleteSchedule:function(e,t){this.selectTimeList.splice(t,1),this.$refs.calendarTable.deleteSchedule(e)},dateCount:function(e,t){var n=t||7,dd=new Date(e);return dd=+dd+864e5*n,(dd=new Date(dd)).getFullYear()+"."+(dd.getMonth()+1<10?"0"+(dd.getMonth()+1):dd.getMonth()+1)+"."+(dd.getDate()<10?"0"+dd.getDate():dd.getDate())},getAllData:function(){var e=this;this.allTimeList=[];var t=[1,2,3,4,5,6,7,8],data=this.$refs.calendarTable.originCourseData,n=this.$refs.calendarTable.dateRange;data.forEach((function(r,l){r.data.forEach((function(o,c){t.forEach((function(t,o){e.allTimeList.push({date:0===o?n[c]:e.dateCount(n[c],7*o),timePeriod:r.timePeriod,index:l,someCircle:c,circle:o+1,teachType:"",isShow:!1})}))}))}))},changeIsShow:function(e,t,n,circle,r){var l=this,o=[e];this.selectTimeList=[];var c=[];if(circle>1)for(var i=1;i<circle;i++)o.push(this.dateCount(e,7*i));o.forEach((function(e){l.allTimeList=l.allTimeList.map((function(l){return new Date(l.date).getTime()===new Date(e).getTime()&&l.timePeriod===t&&(l.teachType=n,l.isShow=r),l}))})),this.allTimeList.forEach((function(e){e.isShow&&c.push(e)})),this.sortTimeList(c),console.log(this.selectTimeList)},changeCricle:function(circle,e){var t=this;if(this.$refs.calendarTable.isSelectTime()){var n=[];e?(this.allTimeList=this.allTimeList.map((function(e){return t.selectTimeList.forEach((function(t){e.index===t.index&&e.someCircle===t.someCircle&&e.circle<circle+1&&(e.isShow=!0,e.teachType=t.teachType)})),e})),this.allTimeList.forEach((function(e){e.isShow&&n.push(e)})),this.sortTimeList(n)):(this.allTimeList=this.allTimeList.map((function(e){return e.circle>circle&&(e.isShow=!1,e.teachType=""),e})),this.allTimeList.forEach((function(e){e.isShow&&n.push(e)})),this.sortTimeList(n))}},sortTimeList:function(e){var t=e;t.sort((function(a,b){return new Date(a.date).getTime()-new Date(b.date).getTime()})),this.selectTimeList=t}}},c=(n(504),n(9)),component=Object(c.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-main",[n("el-form",{ref:"form",attrs:{model:e.paramMap,"label-width":"80px",rules:e.rules,size:"mini","label-position":"left"}},[n("el-row",{attrs:{gutter:18}},[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"科目",prop:"subject"}},[n("el-select",{attrs:{placeholder:"请选择科目"},on:{change:e.changeSubject},model:{value:e.paramMap.subject,callback:function(t){e.$set(e.paramMap,"subject",t)},expression:"paramMap.subject"}},e._l(e.options.subject,(function(e){return n("el-option",{key:e.dicCode,attrs:{label:e.name,value:e.name}})})),1)],1)],1),e._v(" "),n("el-col",{attrs:{span:6}},[n("el-form-item",{attrs:{label:"授课形式",prop:"teachType"}},[n("el-radio-group",{on:{change:e.changeTeachType},model:{value:e.paramMap.teachType,callback:function(t){e.$set(e.paramMap,"teachType",t)},expression:"paramMap.teachType"}},e._l(e.options.teaching_type,(function(t){return n("el-radio",{key:t.dicCode,attrs:{label:t.dicValue}},[e._v(e._s(t.name))])})),1)],1)],1)],1)],1),e._v(" "),n("el-table",{staticClass:"contract",attrs:{data:e.contractList,size:"mini",border:""}},[n("el-table-column",{attrs:{prop:"prop",label:"合同编号","header-align":"center",align:"left",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-radio",{attrs:{label:1},nativeOn:{click:function(n){return e.optionChange(n,t.row,t.$index)}},model:{value:t.row.label,callback:function(n){e.$set(t.row,"label",n)},expression:"scope.row.label"}},[e._v(e._s(t.row.htcode))]),e._v(" "),n("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s("1v1"===t.row.htType?"常":"促"))]),e._v(" "),t.row.ifzs?n("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("赠")]):e._e(),e._v(" "),t.row.ifVip?n("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("VIP")]):e._e(),e._v(" "),t.row.grade?n("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.grade))]):e._e()]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"odate",label:"签约日期",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"prop",label:"购买/已排课时",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.keshi?t.row.keshi:0)+"/"+e._s(t.row.yipaiKeshi?t.row.yipaiKeshi:0))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-link",{attrs:{type:"primary",href:t.row.plTest}},[e._v("成绩")])]}}])})],1),e._v(" "),n("CalendarTable",{ref:"calendarTable",attrs:{showPeriod:!0,singleSelect:!1},on:{changeCourse:e.changeCourse,changeCricle:e.changeCricle}}),e._v(" "),n("h2",[e._v("已选时段")]),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.selectTimeList,border:"",size:"mini"}},[n("el-table-column",{attrs:{prop:"date",label:"日期",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"timePeriod",label:"时段",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"teachType",label:"授课类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(1==t.row.teachType?"直播":"面授")+"\n            ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-link",{attrs:{type:"primary"},on:{click:function(n){return e.deleteSchedule(t.row.id,t.$index)}}},[e._v("删除")])]}}])})],1),e._v(" "),n("div",{staticClass:"footer"},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.showDialog}},[e._v("下一步")])],1)],1)}),[],!1,null,"3eb4ede2",null);t.default=component.exports}}]);